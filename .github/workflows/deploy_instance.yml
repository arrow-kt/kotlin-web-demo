name: Deployment of TryArrow in AWS

on: [push]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v1
    - name: Starting the deployment
      env: # Or as an environment variable
        AWS_TRY_ARROW_PEM: ${{ secrets.AWS_TRY_ARROW_PEM }}
        AWS_EC2_IP_ADDRESS: ${{ secrets.AWS_EC2_IP_ADDRESS }}
        AWS_EC2_SECRET: ${{ secrets.AWS_EC2_SECRET }}
      run: |
        openssl aes-256-cbc -pass "pass:$AWS_EC2_SECRET" -in ./deploy/.secret-action.txt -out ./try.arrow-kt.pem -d -a -nopad
        chmod 400 ./try.arrow-kt.pem
        ssh -o "StrictHostKeyChecking no" -q -i ./try.arrow-kt.pem $AWS_EC2_IP_ADDRESS 'ls; exit'
